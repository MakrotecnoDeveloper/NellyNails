@model List<Producto>
@{
    Layout = null;
}

<!DOCTYPE html>
<html>
<head>
    <title>Makrotecno</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />

    <!-- Custom fonts for this template -->
    <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet">
    <link rel="stylesheet" href="~/AdminLTE/plugins/fontawesome-free/css/all.min.css">
    <!-- Custom styles for this template -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/resume.min.css" />
    <!--<link rel="icon" type="image/jpg" href="~/favicon.ico" />-->
    <style>
        #navbarSupportedContent {
            max-height: 80vh; /* Ajusta esto según tus necesidades */
            overflow-y: auto;
        }
    </style>
</head>
<body id="page-top">

    <div class="content-wrapper">
        <div class="container">
            <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top shadow-lg" id="sideNav">
                <a class="navbar-brand js-scroll-trigger text-center" href="#page-top">
                    <span class="d-block d-lg-none fs-4 fw-bold">Makro Tecno</span>
                    <span class="d-none d-lg-block">
                        <img class="img-fluid img-profile rounded-circle mx-auto mb-3 border border-light" src="~/img/Logo.png" alt="Logo" style="width: 100px; height: 100px;">
                    </span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav flex-column w-100">
                        <li class="nav-item my-2">
                            <a href="../" class="nav-link js-scroll-trigger text-light text-uppercase fw-semibold">
                                <i class="bi bi-tag-fill me-2"></i>Inicio
                            </a>
                        </li>
                        <li class="nav-item my-2">
                            <div class="input-group">
                                <input type="text" id="buscarTexto" class="form-control" placeholder="Buscar..." aria-label="Buscar">
                                <button class="btn btn-outline-light" type="button" onclick="buscarEnPagina()">Buscar</button>
                            </div>
                        </li>
                        <li class="nav-item my-2">
                            <a href="#" class="nav-link text-light text-uppercase fw-semibold" onclick="insertarProducto()">
                                <i class="fas fa-plus-circle me-2"></i>Insertar
                            </a>
                        </li>
                        <li class="nav-item my-2">
                            <a href="#" class="nav-link text-light text-uppercase fw-semibold">
                                <i class="fas fa-edit me-2"></i>Editar
                            </a>
                        </li>
                        <li class="nav-item my-2">
                            <a href="#" class="nav-link text-light text-uppercase fw-semibold" onclick="sacarPorcentaje()">
                                <i class="fas fa-percentage me-2"></i>Porcentaje
                            </a>
                        </li>
                        <li class="nav-item my-2">
                            <a href="#" class="nav-link text-light text-uppercase fw-semibold" onclick="eliminarProducto()">
                                <i class="fas fa-trash-alt me-2"></i>Inhabilitar
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            <div class="row">
                <div class="col-12">
                    <div id="productos-container" class="table-responsive">
                        <table class="table table-striped table-bordered">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">Nombre Producto</th>
                                    <th scope="col">Valor Venta</th>
                                    <th scope="col">Valor Neto Paca</th>
                                    <th scope="col">Valor Unidad</th>
                                    <th scope="col">Ubicación</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var producto in Model)
                                {
                                    <tr>
                                        <td>
                                            <span class="editable" id="Cod_Producto_@producto.Cod_Producto">
                                                @producto.Cod_Producto
                                            </span>
                                            <span class="float-end">
                                                <a href="#" class="text-decoration-none text-muted">
                                                </a>
                                            </span>
                                        </td>
                                        <td>
                                            <span class="editable" id="NombreProducto_@producto.Cod_Producto">
                                                @producto.NombreProducto
                                            </span>
                                            <span class="float-end">
                                                <a href="#" class="text-decoration-none text-muted" onclick="editarCampo('NombreProducto_@producto.Cod_Producto')">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                            </span>
                                        </td>
                                        <td>
                                            <span class="editable" id="ValorVentaProducto_@producto.Cod_Producto">
                                                @producto.ValorVentaProducto
                                            </span>
                                            <span class="float-end">
                                                <a href="#" class="text-decoration-none text-muted" onclick="editarCampo('ValorVentaProducto_@producto.Cod_Producto')">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                            </span>
                                        </td>
                                        <td>
                                            <span class="editable" id="ValorNetoProducto_@producto.Cod_Producto">
                                                @producto.ValorNetoProducto
                                            </span>
                                            <span class="float-end">
                                                <a href="#" class="text-decoration-none text-muted" onclick="editarCampo('ValorNetoProducto_@producto.Cod_Producto')">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                            </span>
                                        </td>
                                        <td>
                                            <span class="editable" id="ValorUnidad_@producto.Cod_Producto">
                                                @producto.ValorUnidad
                                            </span>
                                            <span class="float-end">
                                                <a href="#" class="text-decoration-none text-muted" onclick="editarCampo('ValorUnidad_@producto.Cod_Producto')">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                            </span>
                                        </td>
                                        <td>
                                            <span class="editable" id="Ubicacion_@producto.Cod_Producto">
                                                @producto.Ubicacion
                                            </span>
                                            <span class="float-end">
                                                <a href="#" class="text-decoration-none text-muted" onclick="editarCampo('Ubicacion_@producto.Cod_Producto')">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                            </span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <script>
                function editarCampo(id) {
                    event.preventDefault();
                    var elemento = document.getElementById(id);
                    var currentVal = elemento.textContent.trim();
                    var campo = id.split('_')[0];
                    if (campo == "NombreProducto") {
                        var dato = "Nombre del producto";
                    } else if (campo == "ValorVentaProducto") {
                        var dato = "Valor Venta";
                    } else if (campo == "ValorNetoProducto") {
                        var dato = "Valor Paca";
                    } else if (campo == "ValorUnidad") {
                        var dato = "Valor Unidad";
                    } else if (campo == "Ubicacion") {
                        var dato = "Ubicacion";
                    }
                    var newVal = prompt(dato + "\n\nIntroduce el nuevo valor:", currentVal);

                    if (newVal !== null && newVal.trim() !== "") {
                        campo = id.split('_')[0]; // Campo a actualizar (p.ej., 'nombreProducto')
                        var codProducto = id.split('_')[1]; // Código del producto
                        //console.log("Valor Nuevo: " + newVal + " Campo a Actualizar: " + campo + " ID Producto: " + codProducto);
                        $.ajax({
                            url: '@Url.Action("modificarProInventario", "Home")',
                            type: 'POST',
                            data: { id: codProducto, campo: campo, newVal: newVal },
                            success: function (data) {
                                toastr.success('Producto editado exitosamente.');
                                elemento.textContent = newVal;
                            },
                            error: function () {
                                toastr.error('Error al cargar los productos.');
                            }
                        });
                    }
                }

                function insertarProducto()
                {
                    event.preventDefault();
                    var nombreProducto = prompt("Introduce el nombre del producto");
                    var cantidadProducto = 0;
                    var valorNetoProducto = prompt("Introduce valor neto");
                    var valorNetoProductoFloat = parseFloat(valorNetoProducto);
                    if (isNaN(valorNetoProductoFloat)) {
                        alert("Porfavor, introduce un numero valido");
                    }else {
                        var valorVentaProducto = prompt("Introduce valor de venta");
                        var valorVentaProductoFloat = parseFloat(valorVentaProducto);
                        var valorUnidad = prompt("Introduce valor x unidad");
                        var valorUnidadInt = parseFloat(valorUnidad);
                        if (isNaN(valorVentaProductoFloat)) {
                            alert("Porfavor, introduce un numero valido");
                        } else {
                            var id_empresa = "31969450-0";
                            var categoria = "Abarrotes";
                            var estado = 1;
                            var ubicacion = prompt("Ubicacion ej: Estante #7");
                            $.ajax({
                                url: '@Url.Action("insertarProInventario", "Home")',
                                type: 'POST',
                                data: { nombreProducto: nombreProducto.toUpperCase(), cantidadProducto: cantidadProducto, valorNetoProductoFloat: valorNetoProductoFloat, valorVentaProductoFloat: valorVentaProductoFloat, valorUnidadInt: valorUnidadInt, id_empresa: id_empresa, categoria: categoria, estado: estado, ubicacion: ubicacion },
                                success: function (data) {
                                    alert('Producto insertado.');
                                },
                                error: function () {
                                    alert('Error al insertar los productos.');
                                }
                            });
                        }
                        
                    }
                }


                function buscarEnPagina() 
                {
                    var textoABuscar = document.getElementById('buscarTexto').value.trim();

                    if (textoABuscar !== "") {
                        // Seleccionar el texto que coincide con lo ingresado en el cuadro de búsqueda
                        var bodyText = document.body.innerText;
                        var index = bodyText.indexOf(textoABuscar);

                        if (index !== -1) {
                            // Crea un rango y selecciona el texto encontrado
                            var range = document.createRange();
                            var selection = window.getSelection();

                            // Buscar el primer nodo de texto que contiene el texto buscado
                            var node = document.body;
                            var startNode, startOffset;
                            (function recursiveSearch(node) {
                                if (node.nodeType === Node.TEXT_NODE) {
                                    var nodeValue = node.nodeValue;
                                    var nodeIndex = nodeValue.indexOf(textoABuscar);
                                    if (nodeIndex !== -1) {
                                        startNode = node;
                                        startOffset = nodeIndex;
                                        return;
                                    }
                                }
                                for (var child = node.firstChild; child; child = child.nextSibling) {
                                    recursiveSearch(child);
                                    if (startNode) return;
                                }
                            })(node);

                            if (startNode) {
                                range.setStart(startNode, startOffset);
                                range.setEnd(startNode, startOffset + textoABuscar.length);
                                selection.removeAllRanges();
                                selection.addRange(range);
                                alert("Texto encontrado: " + textoABuscar);
                            } else {
                                alert("Texto no encontrado");
                            }
                        } else {
                            alert("Texto no encontrado");
                        }
                    }
                }

                function sacarPorcentaje() {
                    event.preventDefault();
                    // Solicitar el valor y el porcentaje
                    let valor = parseFloat(prompt("Ingrese el valor:"));
                    let porcentaje = parseFloat(prompt("Ingrese el porcentaje que desea calcular:"));

                    // Calcular el valor del porcentaje
                    let resultadoPorcentaje = (valor * porcentaje) / 100;

                    // Mostrar el resultado del porcentaje calculado
                    alert(`El ${porcentaje}% de ${valor} es: ${resultadoPorcentaje}`);

                    // Preguntar al usuario si desea sumar el resultado al valor original
                    let suma = confirm("¿Desea sumar el resultado al valor original?");

                    if (suma) {
                        let resultadoFinal = valor + resultadoPorcentaje;
                        alert(`El resultado final sumando el porcentaje es: ${resultadoFinal}`);
                    } else {
                        alert("Proceso finalizado.");
                    }
                }
                function eliminarProducto() {
                    event.preventDefault();
                    let id = prompt("Ingrese el ID");
                    $.ajax({
                        url: '@Url.Action("eliminarProductoXID", "Home")',
                        type: 'POST',
                        data: { id: id },
                        success: function (data) {
                            alert('Producto inhabilitado..');
                        },
                        error: function () {
                            alert('Error al inhabilitar el producto.');
                        }
                    });
                }
            </script>

        </div>
    </div>
    <script src="~/AdminLTE/plugins/jquery/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script src="~/AdminLTE/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="~/js/resume.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
</body>
</html>
